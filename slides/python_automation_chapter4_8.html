<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>파이썬 업무 자동화 교육 교안 - 챕터 4</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: visible;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .slide-container {
            width: 100%; max-width: 1920px;
            min-height: 720px;
            margin: 0 auto;
            overflow: visible;
            position: relative;
            background: linear-gradient(135deg, #1a365d 0%, #2d3748 100%);
            color: #fff;
        }
        .pattern-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.3;
        }
        .content {
            position: relative;
            z-index: 1;
            padding: 50px 60px;
        }
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        .page-number {
            background: #4B8BBE;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin-right: 20px;
        }
        .title {
            font-size: 44px;
            font-weight: 700;
            color: #FFD43B;
        }
        .subtitle {
            font-size: 20px;
            color: #e2e8f0;
            margin-top: -5px;
            margin-bottom: 20px;
        }
        .code-examples {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }
        .code-example {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
        }
        .example-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .example-title {
            font-size: 20px;
            font-weight: 600;
            color: #e2e8f0;
            display: flex;
            align-items: center;
        }
        .example-title i {
            color: #FFD43B;
            margin-right: 10px;
        }
        .example-level {
            background-color: rgba(75, 139, 190, 0.4);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            color: #e2e8f0;
            font-weight: 500;
        }
        .code-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .prompt-box {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
        }
        .prompt-label {
            font-size: 14px;
            font-weight: 600;
            color: #FFD43B;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        .prompt-label i {
            margin-right: 8px;
        }
        .prompt-content {
            font-size: 14px;
            color: #cbd5e0;
            line-height: 1.5;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        .code-box {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            overflow: auto;
        }
        .code-label {
            font-size: 14px;
            font-weight: 600;
            color: #FFD43B;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        .code-label i {
            margin-right: 8px;
        }
        pre {
            margin: 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            color: #e2e8f0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .code-notes {
            margin-top: 15px;
            font-size: 14px;
            color: #cbd5e0;
            line-height: 1.5;
        }
        .code-notes strong {
            color: #FFD43B;
        }
        .tips-section {
            background-color: rgba(75, 139, 190, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
        }
        .tips-title {
            font-size: 20px;
            font-weight: 600;
            color: #FFD43B;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .tips-title i {
            margin-right: 10px;
        }
        .tips-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .tip-item {
            display: flex;
            align-items: flex-start;
        }
        .tip-icon {
            color: #FFD43B;
            margin-right: 10px;
            margin-top: 3px;
        }
        .tip-text {
            font-size: 14px;
            color: #e2e8f0;
            line-height: 1.4;
        }
        .footer {
            font-size: 16px;
            color: #a0aec0;
            text-align: center;
            margin-top: 25px;
            font-style: italic;
        }
        .highlight {
            color: #FFD43B;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="slide-container">
        <div class="pattern-bg"></div>
        <div class="content">
            <div class="header">
                <div class="page-number">9</div>
                <div class="title">ChatGPT로 코드 생성하기 - 실전 예제</div>
            </div>
            <div class="subtitle">실제 업무에 활용할 수 있는 코드 예제와 생성 프롬프트</div>
            
            <div class="code-examples">
                <div class="code-example">
                    <div class="example-header">
                        <div class="example-title">
                            <i class="fas fa-file-excel"></i>
                            엑셀 데이터 자동 분석 및 시각화
                        </div>
                        <div class="example-level">중급</div>
                    </div>
                    <div class="code-container">
                        <div class="prompt-box">
                            <div class="prompt-label">
                                <i class="fas fa-comment"></i>
                                ChatGPT 프롬프트
                            </div>
                            <div class="prompt-content">
                                여러 부서에서 제출한 월별 매출 데이터 엑셀 파일들이 있습니다. 각 파일에는 '날짜', '제품명', '수량', '단가', '매출액' 컬럼이 있습니다. 이 파일들을 읽어서 다음 분석을 수행하는 파이썬 코드를 작성해주세요:
                                
                                1. 모든 파일의 데이터를 하나로 통합
                                2. 부서별, 제품별 매출액 합계 계산
                                3. 월별 매출 트렌드 그래프 생성
                                4. 상위 5개 제품을 파이 차트로 시각화
                                5. 결과를 하나의 Excel 파일에 여러 시트로 저장
                            </div>
                        </div>
                        <div class="code-box">
                            <div class="code-label">
                                <i class="fas fa-code"></i>
                                생성된 코드
                            </div>
                            <pre>
import os
import pandas as pd
import matplotlib.pyplot as plt
from datetime import datetime

def analyze_sales_data(input_folder, output_file):
    """
    여러 엑셀 파일의 매출 데이터를 분석하고 시각화하는 함수
    
    Args:
        input_folder: 매출 데이터 엑셀 파일이 있는 폴더 경로
        output_file: 분석 결과를 저장할 엑셀 파일 경로
    """
    # 1. 모든 파일의 데이터 통합
    all_data = []
    
    for filename in os.listdir(input_folder):
        if filename.endswith('.xlsx') or filename.endswith('.xls'):
            file_path = os.path.join(input_folder, filename)
            # 파일명에서 부서명 추출 (예: "영업팀_2023_05.xlsx" -> "영업팀")
            department = filename.split('_')[0]
            
            # 엑셀 파일 로드
            df = pd.read_excel(file_path)
            df['부서'] = department  # 부서 정보 추가
            all_data.append(df)
    
    # 모든 데이터 통합
    if not all_data:
        print("처리할 엑셀 파일이 없습니다.")
        return False
    
    combined_data = pd.concat(all_data, ignore_index=True)
    
    # 날짜 형식 확인 및 변환
    combined_data['날짜'] = pd.to_datetime(combined_data['날짜'])
    combined_data['월'] = combined_data['날짜'].dt.strftime('%Y-%m')
    
    # 2. 부서별, 제품별 매출액 계산
    dept_sales = combined_data.groupby('부서')['매출액'].sum().reset_index()
    product_sales = combined_data.groupby('제품명')['매출액'].sum().sort_values(ascending=False).reset_index()
    top5_products = product_sales.head(5)
    
    # 월별 매출 트렌드
    monthly_sales = combined_data.groupby('월')['매출액'].sum().reset_index()
    
    # 3. 월별 매출 트렌드 그래프 생성
    plt.figure(figsize=(10, 6))
    plt.plot(monthly_sales['월'], monthly_sales['매출액'], marker='o')
    plt.title('월별 매출 트렌드')
    plt.xlabel('월')
    plt.ylabel('매출액')
    plt.xticks(rotation=45)
    plt.tight_layout()
    
    # 임시 파일로 저장
    trend_chart = 'temp_trend_chart.png'
    plt.savefig(trend_chart)
    plt.close()
    
    # 4. 상위 5개 제품 파이 차트 생성
    plt.figure(figsize=(8, 8))
    plt.pie(top5_products['매출액'], labels=top5_products['제품명'], autopct='%1.1f%%')
    plt.title('상위 5개 제품 매출 비중')
    plt.axis('equal')
    
    # 임시 파일로 저장
    pie_chart = 'temp_pie_chart.png'
    plt.savefig(pie_chart)
    plt.close()
    
    # 5. 결과를 Excel 파일로 저장
    with pd.ExcelWriter(output_file, engine='openpyxl') as writer:
        # 원본 데이터 시트
        combined_data.to_excel(writer, sheet_name='원본데이터', index=False)
        
        # 부서별 매출 시트
        dept_sales.to_excel(writer, sheet_name='부서별매출', index=False)
        
        # 제품별 매출 시트
        product_sales.to_excel(writer, sheet_name='제품별매출', index=False)
        
        # 월별 매출 시트
        monthly_sales.to_excel(writer, sheet_name='월별매출', index=False)
        
        # 시각화 결과를 담을 시트
        workbook = writer.book
        worksheet = workbook.create_sheet('시각화결과')
        
        # 이미지 삽입
        from openpyxl.drawing.image import Image
        
        # 트렌드 차트 삽입
        img1 = Image(trend_chart)
        worksheet.add_image(img1, 'A1')
        
        # 파이 차트 삽입
        img2 = Image(pie_chart)
        worksheet.add_image(img2, 'A20')
    
    # 임시 파일 삭제
    os.remove(trend_chart)
    os.remove(pie_chart)
    
    print(f"분석 완료! 결과가 {output_file}에 저장되었습니다.")
    return True

# 사용 예시
# analyze_sales_data("sales_data", "sales_analysis_report.xlsx")</pre>
                        </div>
                    </div>
                    <div class="code-notes">
                        <strong>주요 포인트:</strong> 이 코드는 pandas로 데이터를 통합하고, matplotlib을 사용해 시각화한 후, openpyxl을 통해 엑셀 파일에 그래프를 삽입합니다. 특히 파일명에서 부서정보를 추출하는 방식으로 메타데이터를 활용하는 점이 유용합니다.
                    </div>
                </div>
                
                <div class="code-example">
                    <div class="example-header">
                        <div class="example-title">
                            <i class="fas fa-envelope"></i>
                            이메일 자동 모니터링 및 처리
                        </div>
                        <div class="example-level">고급</div>
                    </div>
                    <div class="code-container">
                        <div class="prompt-box">
                            <div class="prompt-label">
                                <i class="fas fa-comment"></i>
                                ChatGPT 프롬프트
                            </div>
                            <div class="prompt-content">
                                특정 Gmail 계정에서 "월간보고서" 제목이 포함된 이메일을 자동으로 확인하고, 첨부된 엑셀 파일을 다운로드하여 특정 폴더에 저장하는 파이썬 스크립트를 작성해주세요. 이메일이 처리되면 발신자에게 "보고서가 성공적으로 접수되었습니다"라는 확인 메일을 자동으로 회신해야 합니다. 또한 보안을 위해 이메일 계정 정보는 환경 변수에서 불러오도록 해주세요.
                            </div>
                        </div>
                        <div class="code-box">
                            <div class="code-label">
                                <i class="fas fa-code"></i>
                                생성된 코드
                            </div>
                            <pre>
import os
import imaplib
import email
import tempfile
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.header import decode_header
from datetime import datetime
from dotenv import load_dotenv

# .env 파일에서 환경 변수 로드
load_dotenv()

def monitor_and_process_emails():
    """
    Gmail에서 '월간보고서' 제목이 포함된 이메일을 확인하고 
    첨부 파일을 다운로드한 후 확인 메일을 발송하는 함수
    """
    # 환경 변수에서 계정 정보 로드
    EMAIL_ADDRESS = os.getenv('EMAIL_ADDRESS')
    EMAIL_PASSWORD = os.getenv('EMAIL_PASSWORD')
    SAVE_DIRECTORY = os.getenv('SAVE_DIRECTORY', 'reports')
    
    # 저장 디렉토리가 없으면 생성
    if not os.path.exists(SAVE_DIRECTORY):
        os.makedirs(SAVE_DIRECTORY)
    
    # 로그 파일 설정
    log_file = os.path.join(SAVE_DIRECTORY, 'email_log.txt')
    
    try:
        # IMAP 서버 연결
        mail = imaplib.IMAP4_SSL('imap.gmail.com')
        mail.login(EMAIL_ADDRESS, EMAIL_PASSWORD)
        mail.select('inbox')
        
        # '월간보고서' 제목 검색
        status, messages = mail.search(None, 'SUBJECT "월간보고서" UNSEEN')
        
        if status != 'OK' or not messages[0]:
            print("처리할 새 이메일이 없습니다.")
            with open(log_file, 'a', encoding='utf-8') as f:
                f.write(f"{datetime.now()}: 처리할 새 이메일이 없습니다.\n")
            return
        
        # 메시지 ID 목록
        messages = messages[0].split()
        print(f"{len(messages)}개의 새 '월간보고서' 이메일을 찾았습니다.")
        
        for mail_id in messages:
            # 이메일 가져오기
            status, msg_data = mail.fetch(mail_id, '(RFC822)')
            
            if status != 'OK':
                continue
                
            # 이메일 파싱
            msg = email.message_from_bytes(msg_data[0][1])
            subject, encoding = decode_header(msg['Subject'])[0]
            if isinstance(subject, bytes):
                subject = subject.decode(encoding or 'utf-8')
            
            # 발신자 정보 추출
            from_address = msg['From']
            print(f"처리 중: {subject} (From: {from_address})")
            
            # 첨부 파일 검색 및 저장
            attachments_saved = []
            
            for part in msg.walk():
                if part.get_content_maintype() == 'multipart':
                    continue
                
                filename = part.get_filename()
                if filename:
                    # 헤더 디코딩
                    if decode_header(filename)[0][1]:
                        filename = decode_header(filename)[0][0].decode(decode_header(filename)[0][1])
                    
                    # 엑셀 파일만 저장
                    if filename.endswith('.xlsx') or filename.endswith('.xls'):
                        # 파일명에 타임스탬프 추가
                        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
                        save_path = os.path.join(
                            SAVE_DIRECTORY, 
                            f"{timestamp}_{filename}"
                        )
                        
                        # 파일 저장
                        with open(save_path, 'wb') as f:
                            f.write(part.get_payload(decode=True))
                        
                        attachments_saved.append(save_path)
                        print(f"첨부 파일 저장됨: {save_path}")
            
            # 이메일에 처리 완료 표시
            mail.store(mail_id, '+FLAGS', '\\Seen')
            
            # 첨부 파일이 있으면 확인 메일 발송
            if attachments_saved:
                send_confirmation_email(
                    to_address=from_address,
                    subject=f"RE: {subject}",
                    files=attachments_saved
                )
                
                with open(log_file, 'a', encoding='utf-8') as f:
                    f.write(f"{datetime.now()}: 처리됨 - {subject} (From: {from_address})\n")
                    for file in attachments_saved:
                        f.write(f"  -> 저장된 파일: {file}\n")
            
        mail.close()
        mail.logout()
        
    except Exception as e:
        print(f"오류 발생: {str(e)}")
        with open(log_file, 'a', encoding='utf-8') as f:
            f.write(f"{datetime.now()}: 오류 - {str(e)}\n")

def send_confirmation_email(to_address, subject, files):
    """
    발신자에게 확인 이메일을 보내는 함수
    
    Args:
        to_address: 수신자 이메일 주소
        subject: 이메일 제목
        files: 처리된 파일 목록
    """
    EMAIL_ADDRESS = os.getenv('EMAIL_ADDRESS')
    EMAIL_PASSWORD = os.getenv('EMAIL_PASSWORD')
    
    # 이메일 객체 생성
    msg = MIMEMultipart()
    msg['From'] = EMAIL_ADDRESS
    msg['To'] = to_address
    msg['Subject'] = subject
    
    # 이메일 본문
    body = f"""
    <html>
    <body>
        <p>안녕하세요,</p>
        <p>귀하의 보고서가 성공적으로 접수되었습니다.</p>
        <p>처리된 파일:</p>
        <ul>
    """
    
    for file in files:
        body += f"<li>{os.path.basename(file)}</li>"
    
    body += """
        </ul>
        <p>감사합니다.</p>
        <p>자동 응답 시스템</p>
    </body>
    </html>
    """
    
    msg.attach(MIMEText(body, 'html'))
    
    try:
        # SMTP 서버 연결
        server = smtplib.SMTP('smtp.gmail.com', 587)
        server.starttls()
        server.login(EMAIL_ADDRESS, EMAIL_PASSWORD)
        
        # 이메일 발송
        server.send_message(msg)
        server.quit()
        
        print(f"확인 이메일이 {to_address}로 발송되었습니다.")
        return True
    
    except Exception as e:
        print(f"이메일 발송 중 오류 발생: {str(e)}")
        return False

if __name__ == "__main__":
    monitor_and_process_emails()</pre>
                        </div>
                    </div>
                    <div class="code-notes">
                        <strong>주요 포인트:</strong> 이 코드는 IMAP과 SMTP 프로토콜을 사용하여 이메일을 모니터링하고 자동 응답합니다. python-dotenv를 활용해 보안 정보를 환경 변수로 관리하며, 로깅 기능을 통해 모든 처리 과정을 기록합니다. 실제 자동화 스크립트로 사용하려면 스케줄러(예: cron, Windows 작업 스케줄러)에 등록하면 됩니다.
                    </div>
                </div>
            </div>
            
            <div class="tips-section">
                <div class="tips-title">
                    <i class="fas fa-lightbulb"></i>
                    ChatGPT로 생성한 코드 개선하기
                </div>
                <div class="tips-content">
                    <div class="tip-item">
                        <div class="tip-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="tip-text"><strong class="highlight">보안 검토:</strong> 자격 증명이나 민감한 정보가 하드코딩되어 있는지 확인하고, 환경 변수나 시스템 저장소를 사용하도록 수정하세요.</div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="tip-text"><strong class="highlight">에러 처리 보강:</strong> 다양한 예외 상황에 대한 처리를 추가하고, 로깅을 통해 오류 원인을 쉽게 파악할 수 있게 개선하세요.</div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="tip-text"><strong class="highlight">검증 로직 추가:</strong> 입력 데이터의 유효성 검사와 결과의 타당성을 검증하는 로직을 추가하세요.</div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="tip-text"><strong class="highlight">모듈화 개선:</strong> 큰 함수는 더 작고 특정 기능에 집중한 여러 함수로 분리하여 가독성과 재사용성을 높이세요.</div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                "ChatGPT는 강력한 코드 생성 도구이지만, 실제 업무에 적용하기 전에 생성된 코드를 검토하고 최적화하는 과정이 필요합니다."
            </div>
        </div>
    </div>
</body>
    